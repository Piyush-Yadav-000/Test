# ================================================================
# MOCKARENA ENHANCED - DATABASE CONFIGURATION (FIXED)
# ================================================================
spring.application.name=mockarena-enhanced

# ================================================================
# MYSQL DATABASE CONFIGURATION (READ/WRITE ENABLED)
# ================================================================
# MySQL Database Connection with explicit read/write settings
spring.datasource.url=jdbc:mysql://localhost:3306/mockarena?useSSL=false&serverTimezone=UTC&allowPublicKeyRetrieval=true&autoReconnect=true&useUnicode=true&characterEncoding=UTF-8
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver
spring.datasource.username=root
spring.datasource.password=Rame#1974

# ================================================================
# HIKARI CONNECTION POOL (FIXED FOR READ/WRITE)
# ================================================================
spring.datasource.hikari.maximum-pool-size=20
spring.datasource.hikari.minimum-idle=5
spring.datasource.hikari.idle-timeout=300000
spring.datasource.hikari.connection-timeout=20000
spring.datasource.hikari.validation-timeout=5000
spring.datasource.hikari.leak-detection-threshold=60000
# CRITICAL: Ensure connections are not read-only
spring.datasource.hikari.read-only=false
spring.datasource.hikari.auto-commit=true

# ================================================================
# JPA & HIBERNATE CONFIGURATION (ENHANCED)
# ================================================================
spring.jpa.hibernate.ddl-auto=update
spring.jpa.generate-ddl=true
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQL8Dialect
spring.jpa.properties.hibernate.jdbc.time_zone=UTC

# CRITICAL: Ensure JPA allows writes
spring.jpa.properties.hibernate.connection.provider_disables_autocommit=false
spring.jpa.properties.hibernate.connection.characterEncoding=utf-8
spring.jpa.properties.hibernate.connection.CharSet=utf-8
spring.jpa.properties.hibernate.connection.useUnicode=true

# ================================================================
# TRANSACTION MANAGEMENT (FIXED)
# ================================================================
spring.jpa.properties.hibernate.current_session_context_class=thread
spring.jpa.properties.hibernate.jdbc.batch_size=20
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
spring.jpa.properties.hibernate.jdbc.batch_versioned_data=true

# ================================================================
# JWT SECURITY CONFIGURATION
# ================================================================
mockarena.security.jwt.secret-key=mockarena-enhanced-secret-key-2025-production-ready
mockarena.security.jwt.access-token-expiration=3600000

# ================================================================
# JUDGE0 CONFIGURATION
# ================================================================
mockarena.judge0.base-url=https://ce.judge0.com
mockarena.judge0.api-key=66e8e92ebamshb20b8c3e8e020ffp12e895jsna19d23258455
mockarena.judge0.max-timeout=30000


# HTTP Client Configuration
spring.webflux.multipart.max-in-memory-size=10MB
logging.level.reactor.netty.http.client=DEBUG
logging.level.org.springframework.web.reactive=DEBUG


# ================================================================
# ASYNC PROCESSING CONFIGURATION
# ================================================================
spring.task.execution.pool.core-size=4
spring.task.execution.pool.max-size=8
spring.task.execution.pool.queue-capacity=100

# ================================================================
# SERVER CONFIGURATION
# ================================================================
server.port=8080
server.error.include-message=always
server.error.include-binding-errors=always

# ================================================================
# CORS CONFIGURATION
# ================================================================
mockarena.security.cors.allowed-origins=http://localhost:3000,http://localhost:5173,http://localhost:4200
mockarena.security.cors.allowed-methods=GET,POST,PUT,DELETE,OPTIONS,PATCH
mockarena.security.cors.allowed-headers=*
mockarena.security.cors.allow-credentials=true

# ================================================================
# LOGGING CONFIGURATION
# ================================================================
logging.level.com.piyush.mockarena=INFO
logging.level.org.springframework.security=INFO
logging.level.org.springframework.web=INFO
logging.level.org.hibernate.SQL=DEBUG
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=TRACE
logging.pattern.console=%clr(%d{HH:mm:ss.SSS}){faint} %clr(${LOG_LEVEL_PATTERN:-%5p}) %clr([%15.15t]){faint} %clr(%-40.40logger{39}){cyan} %clr(:){faint} %m%n%wEx

# ================================================================
# API DOCUMENTATION (SWAGGER)
# ================================================================
springdoc.api-docs.path=/v3/api-docs
springdoc.swagger-ui.path=/swagger-ui.html
springdoc.swagger-ui.operationsSorter=method
springdoc.swagger-ui.default-models-expand-depth=-1

# ================================================================
# CACHING CONFIGURATION
# ================================================================
spring.cache.type=caffeine
spring.cache.caffeine.spec=maximumSize=1000,expireAfterWrite=60m

# ================================================================
# ACTUATOR (MONITORING)
# ================================================================
management.endpoints.web.exposure.include=health,info,metrics,env
management.endpoint.health.show-details=when-authorized
management.metrics.export.simple.enabled=true

# ================================================================
# FILE UPLOAD CONFIGURATION
# ================================================================
spring.servlet.multipart.max-file-size=10MB
spring.servlet.multipart.max-request-size=10MB
mockarena.file.upload-dir=./uploads/
mockarena.file.profile-pictures-dir=./uploads/profiles/

# ================================================================
# DEVELOPMENT HELPERS
# ================================================================
spring.devtools.restart.enabled=true
spring.devtools.livereload.enabled=true
